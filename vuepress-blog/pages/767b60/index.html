<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>docker环境搭建 | vivid&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/vuepress-blog/img/favicon.ico">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="/vuepress-blog/img/adsbygoogle.js"></script>
    <meta name="description" content="技术文章">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/vuepress-blog/assets/css/0.styles.8afc26ef.css" as="style"><link rel="preload" href="/vuepress-blog/assets/js/app.a368dedd.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/2.55043232.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/10.a255b6be.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/js/11.f5c98504.js"><link rel="prefetch" href="/vuepress-blog/assets/js/12.628e40d3.js"><link rel="prefetch" href="/vuepress-blog/assets/js/13.6e04af8a.js"><link rel="prefetch" href="/vuepress-blog/assets/js/14.80d3223f.js"><link rel="prefetch" href="/vuepress-blog/assets/js/15.190a5bc8.js"><link rel="prefetch" href="/vuepress-blog/assets/js/16.cb65cf15.js"><link rel="prefetch" href="/vuepress-blog/assets/js/17.c4a05da1.js"><link rel="prefetch" href="/vuepress-blog/assets/js/18.9291867d.js"><link rel="prefetch" href="/vuepress-blog/assets/js/19.44b363a8.js"><link rel="prefetch" href="/vuepress-blog/assets/js/20.b4cfb897.js"><link rel="prefetch" href="/vuepress-blog/assets/js/21.bb25c5f6.js"><link rel="prefetch" href="/vuepress-blog/assets/js/22.a972247e.js"><link rel="prefetch" href="/vuepress-blog/assets/js/23.cfa8576a.js"><link rel="prefetch" href="/vuepress-blog/assets/js/24.f7b2fde7.js"><link rel="prefetch" href="/vuepress-blog/assets/js/25.cd9b3e00.js"><link rel="prefetch" href="/vuepress-blog/assets/js/3.f545c6a9.js"><link rel="prefetch" href="/vuepress-blog/assets/js/4.7bcc31ce.js"><link rel="prefetch" href="/vuepress-blog/assets/js/5.9555c16a.js"><link rel="prefetch" href="/vuepress-blog/assets/js/6.24a500e6.js"><link rel="prefetch" href="/vuepress-blog/assets/js/7.b3656081.js"><link rel="prefetch" href="/vuepress-blog/assets/js/8.a15f48c3.js"><link rel="prefetch" href="/vuepress-blog/assets/js/9.a3107a25.js">
    <link rel="stylesheet" href="/vuepress-blog/assets/css/0.styles.8afc26ef.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-blog/" class="home-link router-link-active"><img src="/vuepress-blog/img/EB-logo.png" alt="vivid's blog" class="logo"> <span class="site-name can-hide">vivid's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress-blog/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="教程" class="dropdown-title"><a href="/vuepress-blog/tutorials/" class="link-title">教程</a> <span class="title" style="display:none;">教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/pages/767b60/" aria-current="page" class="nav-link router-link-exact-active router-link-active">docker</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/pages/767b70/" class="nav-link">其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><a href="/vuepress-blog/interview/" class="link-title">面试</a> <span class="title" style="display:none;">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/pages/2a9113/" class="nav-link">mysql相关</a></li></ul></div></div><div class="nav-item"><a href="/vuepress-blog/pages/2a9118/" class="nav-link">golang</a></div><div class="nav-item"><a href="/vuepress-blog/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/vuepress-blog/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://gitee.com/vividcode/vuepress-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Source
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/vuepress-blog/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="教程" class="dropdown-title"><a href="/vuepress-blog/tutorials/" class="link-title">教程</a> <span class="title" style="display:none;">教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/pages/767b60/" aria-current="page" class="nav-link router-link-exact-active router-link-active">docker</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/pages/767b70/" class="nav-link">其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><a href="/vuepress-blog/interview/" class="link-title">面试</a> <span class="title" style="display:none;">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/pages/2a9113/" class="nav-link">mysql相关</a></li></ul></div></div><div class="nav-item"><a href="/vuepress-blog/pages/2a9118/" class="nav-link">golang</a></div><div class="nav-item"><a href="/vuepress-blog/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/vuepress-blog/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://gitee.com/vividcode/vuepress-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Source
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>docker</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-blog/pages/767b60/" aria-current="page" class="active sidebar-link">docker环境搭建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-blog/pages/767b60/#配置docker-代理" class="sidebar-link">配置docker 代理</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/pages/767b60/#安装docker-centos7-112" class="sidebar-link">安装docker: CentOS7 112</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/pages/767b60/#安装docker-compose" class="sidebar-link">安装docker-compose</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/pages/767b60/#具体步骤" class="sidebar-link">具体步骤</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/pages/767b60/#elasticsearch需要安装中文分词器ikanalyzer-并重新启动。" class="sidebar-link">elasticsearch需要安装中文分词器IKAnalyzer，并重新启动。</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/pages/767b60/#logstash-需要安装json-lines插件-并重新启动" class="sidebar-link">logstash 需要安装json_lines插件，并重新启动</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/pages/767b60/#青龙面板更新" class="sidebar-link">青龙面板更新</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/pages/767b60/#zerotier-docker搭建" class="sidebar-link">zerotier docker搭建</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/pages/767b60/#docker-安装transmission" class="sidebar-link">docker 安装transmission</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/pages/767b60/#docker-安装clouddrive" class="sidebar-link">docker 安装CloudDrive</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-blog/pages/767b60/#开启磁盘共享" class="sidebar-link">开启磁盘共享</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/pages/767b60/#安装" class="sidebar-link">安装</a></li></ul></li><li class="sidebar-sub-header"><a href="/vuepress-blog/pages/767b60/#nas-tool" class="sidebar-link">nas-tool</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/pages/767b60/#chinesesubfinder" class="sidebar-link">chinesesubfinder</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其他</span> <span class="arrow right"></span></p> <!----></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/vuepress-blog/" title="首页" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><a href="/vuepress-blog/tutorials" title="教程-目录页" data-v-1cd794fe>教程</a></li> <li data-v-1cd794fe><a href="/vuepress-blog/tutorials/#docker" title="教程#docker" data-v-1cd794fe>docker</a></li> <!----></ul> <div class="info" data-v-1cd794fe><div title="作者" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/xugaoyi" target="_blank" title="作者" class="beLink" data-v-1cd794fe>vivid</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2020-02-21</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">
          docker环境搭建
        </h1> <div class="page-slot page-slot-top"><!-- 固定100% * 90px可显示，max-height:90px未见显示-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><h2 id="配置docker-代理"><a href="#配置docker-代理" class="header-anchor">#</a> 配置docker 代理</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vim</span> /etc/docker/daemon.json

<span class="token punctuation">{</span>
  <span class="token string">&quot;registry-mirrors&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://ih6ib4yz.mirror.aliyuncs.com&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token function">sudo</span> systemctl daemon-reload
<span class="token function">sudo</span> systemctl restart docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="安装docker-centos7-112"><a href="#安装docker-centos7-112" class="header-anchor">#</a> 安装docker: CentOS7 112</h2> <p>1、若您安装过<strong>docker</strong>，需要先删掉，之后再安装依赖:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> yum remove docker docker-common docker-selinux docker-engine
<span class="token function">sudo</span> yum <span class="token function">install</span> -y yum-utils device-mapper-persistent-data lvm2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>2、根据版本不同，下载repo文件。您使用的发行版：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">wget</span> -O /etc/yum.repos.d/docker-ce.repo https://repo.huaweicloud.com/docker-ce/linux/centos/docker-ce.repo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>软件仓库地址替换为：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> <span class="token function">sed</span> -i <span class="token string">'s+download.docker.com+repo.huaweicloud.com/docker-ce+'</span> /etc/yum.repos.d/docker-ce.repo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>3、更新索引文件并安装</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> yum makecache fast
<span class="token function">sudo</span> yum <span class="token function">install</span> docker-ce
<span class="token comment">#启动docker</span>
systemctl start docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="安装docker-compose"><a href="#安装docker-compose" class="header-anchor">#</a> 安装docker-compose</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#将可执行权限应用于二进制文件：</span>
<span class="token comment">#创建软链：</span>
<span class="token comment">#测试是否安装成功：</span>
<span class="token comment">#上传 docker-compose 文件</span>
<span class="token function">sudo</span> <span class="token function">chmod</span> +x /home/docker-compose

<span class="token function">sudo</span> <span class="token function">ln</span> -s /home/docker-compose /usr/bin/docker-compose


docker-compose --version
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="具体步骤"><a href="#具体步骤" class="header-anchor">#</a> 具体步骤</h2> <p>​</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 改变设置</span>
<span class="token comment"># 使之立即生效</span>
<span class="token comment"># 创建目录</span>
<span class="token comment"># 创建目录</span>
<span class="token comment"># 创建并改变该目录权限</span>

sysctl -w vm.max_map_count<span class="token operator">=</span><span class="token number">262144</span>
sysctl -p
<span class="token function">mkdir</span> /opt/elasticsearch/data/
<span class="token function">chmod</span> <span class="token number">777</span> /opt/elasticsearch/data
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>修改Logstash的配置文件logstash.conf中output节点下的Elasticsearch连接地址为es:9200。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>mkdir /opt/logstash

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment">#logstash.conf文件内容</span>
input {
  tcp {
    mode =&gt; &quot;server&quot;
    host =&gt; &quot;0.0.0.0&quot;
    port =&gt; 4560
    codec =&gt; json_lines
    type =&gt; &quot;debug&quot;
  }
  tcp {
    mode =&gt; &quot;server&quot;
    host =&gt; &quot;0.0.0.0&quot;
    port =&gt; 4561
    codec =&gt; json_lines
    type =&gt; &quot;error&quot;
  }
  tcp {
    mode =&gt; &quot;server&quot;
    host =&gt; &quot;0.0.0.0&quot;
    port =&gt; 4562
    codec =&gt; json_lines
    type =&gt; &quot;business&quot;
  }
  tcp {
    mode =&gt; &quot;server&quot;
    host =&gt; &quot;0.0.0.0&quot;
    port =&gt; 4563
    codec =&gt; json_lines
    type =&gt; &quot;record&quot;
  }
}
filter{
  if [type] == &quot;record&quot; {
    mutate {
      remove_field =&gt; &quot;port&quot;
      remove_field =&gt; &quot;host&quot;
      remove_field =&gt; &quot;@version&quot;
    }
    json {
      source =&gt; &quot;message&quot;
      remove_field =&gt; [&quot;message&quot;]
    }
  }
}
output {
  elasticsearch {
    hosts =&gt; &quot;es:9200&quot;
    index =&gt; &quot;mall-%{type}-%{+YYYY.MM.dd}&quot;
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p>新建 docker-compose-env.yml 文件</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code>version: '3'
services:

  elasticsearch:
    image: elasticsearch:7.6.2
    container_name: elasticsearch
    environment:
      - &quot;cluster.name=elasticsearch&quot; #设置集群名称为elasticsearch
      - &quot;discovery.type=single-node&quot; #以单一节点模式启动
      - &quot;ES_JAVA_OPTS=-Xms256m -Xmx256m&quot; #设置使用jvm内存大小
    volumes:
      - /opt/elasticsearch/plugins:/usr/share/elasticsearch/plugins #插件文件挂载
      - /opt/elasticsearch/data:/usr/share/elasticsearch/data #数据文件挂载
    ports:
      - 9200:9200
      - 9300:9300
  logstash:
    image: logstash:7.6.2
    container_name: logstash
    environment:
      - TZ=Asia/Shanghai
    volumes:
      - /opt/logstash/logstash.conf:/usr/share/logstash/pipeline/logstash.conf #挂载logstash的配置文件
    depends_on:
      - elasticsearch #kibana在elasticsearch启动之后再启动
    links:
      - elasticsearch:es #可以用es这个域名访问elasticsearch服务
    ports:
      - 4560:4560
      - 4561:4561
      - 4562:4562
      - 4563:4563
  kibana:
    image: kibana:7.6.2
    container_name: kibana
    links:
      - elasticsearch:es #可以用es这个域名访问elasticsearch服务
    depends_on:
      - elasticsearch #kibana在elasticsearch启动之后再启动
    environment:
      - &quot;elasticsearch.hosts=http://es:9200&quot; #设置访问elasticsearch的地址
    ports:
      - 5601:5601
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>执行命令</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code> docker-compose -f docker-compose-env.yml up -d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="elasticsearch需要安装中文分词器ikanalyzer-并重新启动。"><a href="#elasticsearch需要安装中文分词器ikanalyzer-并重新启动。" class="header-anchor">#</a> elasticsearch需要安装中文分词器IKAnalyzer，并重新启动。</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker <span class="token builtin class-name">exec</span> -it elasticsearch /bin/bash
<span class="token comment">#此命令需要在容器中运行</span>
elasticsearch-plugin <span class="token function">install</span> https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.6.2/elasticsearch-analysis-ik-7.6.2.zip
docker restart elasticsearch
<span class="token comment">#elasticsearch-sql</span>
elasticsearch-plugin <span class="token function">install</span> https://github.com/NLPchina/elasticsearch-sql/releases/download/7.6.2.0/elasticsearch-sql-7.6.2.0.zip


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="logstash-需要安装json-lines插件-并重新启动"><a href="#logstash-需要安装json-lines插件-并重新启动" class="header-anchor">#</a> logstash 需要安装<code>json_lines</code>插件，并重新启动</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker <span class="token builtin class-name">exec</span> -it logstash /bin/bash
logstash-plugin <span class="token function">install</span> logstash-codec-json_lines
docker restart logstash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="青龙面板更新"><a href="#青龙面板更新" class="header-anchor">#</a> 青龙面板更新</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>docker <span class="token builtin class-name">exec</span> -it qinglong /bin/bash
ql repo https://github.com/atyvcn/jd_scripts.git <span class="token string">&quot;jd_|jx_|getJDCookie&quot;</span> <span class="token string">&quot;backUp|icon&quot;</span> <span class="token string">&quot;^jd[^_]|USER|sendNotify|sign_graphics_validate|JDJR|JDSign&quot;</span> <span class="token string">&quot;main&quot;</span>

ql repo https://github.com/zero205/JD_tencent_scf.git <span class="token string">&quot;jd_|jx_|getJDCookie&quot;</span> <span class="token string">&quot;backUp|icon&quot;</span> <span class="token string">&quot;^jd[^_]|USER|sendNotify|sign_graphics_validate|JDJR|JDSign&quot;</span> <span class="token string">&quot;main&quot;</span>

https://gh.fakev.cn/KingRan/KR.git
 docker-compose  up -d
 
 【青龙】拉取仓库命令：ql repo https://github.com/atyvcn/jd_scripts.git <span class="token string">&quot;jd_|jx_|ty_|CheckRpeat&quot;</span> <span class="token string">&quot;backUp|icon&quot;</span> <span class="token string">&quot;^jd[^_]|^JD|USER|sendNotify|sign_graphics_validate&quot;</span> <span class="token string">&quot;main&quot;</span>

上面命令拉取错误的使用这个：ql repo https://ghproxy.com/https://github.com/atyvcn/jd_scripts.git <span class="token string">&quot;jd_|jx_|ty_|CheckRpeat&quot;</span> <span class="token string">&quot;backUp|icon&quot;</span> <span class="token string">&quot;^jd[^_]|^JD|USER|sendNotify|sign_graphics_validate&quot;</span> <span class="token string">&quot;main&quot;</span>
<span class="token comment">##</span>
ql repo https://gh.fakev.cn/KingRan/KR.git <span class="token string">&quot;jd_|jx_|getJDCookie&quot;</span> <span class="token string">&quot;backUp|icon&quot;</span> <span class="token string">&quot;^jd[^_]|USER|sendNotify|sign_graphics_validate|JDJR|JDSign&quot;</span> <span class="token string">&quot;main&quot;</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="zerotier-docker搭建"><a href="#zerotier-docker搭建" class="header-anchor">#</a> zerotier docker搭建</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">### date:2021年11月29日</span>
<span class="token comment">### author: www.mrdoc.fun | jonnyan404</span>
<span class="token comment">### 转载请保留来源</span>
version: <span class="token string">'2.0'</span>
services:
    ztncui:
        container_name: ztncui
        restart: always
        environment:
            - <span class="token assign-left variable">MYADDR</span><span class="token operator">=</span>vivid1234.f3322.net <span class="token comment">#公网ip</span>
            - <span class="token assign-left variable">HTTP_PORT</span><span class="token operator">=</span><span class="token number">4000</span>
            - <span class="token assign-left variable">HTTP_ALL_INTERFACES</span><span class="token operator">=</span>yes
            - <span class="token assign-left variable">ZTNCUI_PASSWD</span><span class="token operator">=</span>mrdoc.fun
        ports:
            - <span class="token string">'4000:4000'</span>
           <span class="token comment"># - '3180:3180'具体参考GitHub项目说明</span>
        image: keynetworks/ztncui
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="docker-安装transmission"><a href="#docker-安装transmission" class="header-anchor">#</a> docker 安装transmission</h2> <ul><li>ui地址： <a href="https://github.com/ronggang/transmission-web-control" target="_blank" rel="noopener noreferrer">transmission<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>Skip to content
Search or jump to…
Pull requests
Issues
Marketplace
Explore
 
@MyhangsYourdream 
ronggang
/
transmission-web-control
Public
Code
Issues
<span class="token number">193</span>
Pull requests
<span class="token number">3</span>
Discussions
Actions
Projects
Wiki
Security
Insights
transmission-web-control/release/install-tr-control-cn.sh
@xzxiaoshan
xzxiaoshan fix bug: 对于指定安装目录的情况下，脚本未做处理
Latest commit 72cfac8 on <span class="token number">22</span> Nov <span class="token number">2021</span>
 History
 <span class="token number">3</span> contributors
@ronggang@xzxiaoshan@papadave66
<span class="token number">516</span> lines <span class="token punctuation">(</span><span class="token number">465</span> sloc<span class="token punctuation">)</span>  <span class="token number">13.3</span> KB

<span class="token comment">#!/bin/bash</span>
<span class="token comment"># 获取第一个参数</span>
<span class="token assign-left variable">ARG1</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$1</span>&quot;</span>
<span class="token assign-left variable">ROOT_FOLDER</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>
<span class="token assign-left variable">SCRIPT_NAME</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$0</span>&quot;</span>
<span class="token assign-left variable">SCRIPT_VERSION</span><span class="token operator">=</span><span class="token string">&quot;1.2.3&quot;</span>
<span class="token assign-left variable">VERSION</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>
<span class="token assign-left variable">WEB_FOLDER</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>
<span class="token assign-left variable">ORG_INDEX_FILE</span><span class="token operator">=</span><span class="token string">&quot;index.original.html&quot;</span>
<span class="token assign-left variable">INDEX_FILE</span><span class="token operator">=</span><span class="token string">&quot;index.html&quot;</span>
<span class="token assign-left variable">TMP_FOLDER</span><span class="token operator">=</span><span class="token string">&quot;/tmp/tr-web-control&quot;</span>
<span class="token assign-left variable">PACK_NAME</span><span class="token operator">=</span><span class="token string">&quot;master.tar.gz&quot;</span>
<span class="token assign-left variable">WEB_HOST</span><span class="token operator">=</span><span class="token string">&quot;https://github.com/ronggang/transmission-web-control/archive/&quot;</span>
<span class="token assign-left variable">DOWNLOAD_URL</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$WEB_HOST</span><span class="token variable">$PACK_NAME</span>&quot;</span>
<span class="token comment"># 安装类型</span>
<span class="token comment"># 1 安装至当前 Transmission Web 所在目录</span>
<span class="token comment"># 2 安装至 TRANSMISSION_WEB_HOME 环境变量指定的目录，参考：https://github.com/transmission/transmission/wiki/Environment-Variables#transmission-specific-variables</span>
<span class="token comment"># 使用环境变量时，如果 transmission 不是当前用户运行的，则需要将 TRANSMISSION_WEB_HOME 添加至 /etc/profile 文件，以达到“永久”的目的</span>
<span class="token comment"># 3 用户指定参数做为目录，如 sh install-tr-control.sh /usr/local/transmission/share/transmission</span>
<span class="token assign-left variable">INSTALL_TYPE</span><span class="token operator">=</span>-1
<span class="token assign-left variable">SKIP_SEARCH</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">AUTOINSTALL</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token keyword">if</span> <span class="token function">which</span> <span class="token function">whoami</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span>
	<span class="token assign-left variable"><span class="token environment constant">USER</span></span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">whoami</span><span class="token variable">`</span></span>
<span class="token keyword">fi</span>

<span class="token comment">#==========================================================</span>
<span class="token assign-left variable">MSG_TR_WORK_FOLDER</span><span class="token operator">=</span><span class="token string">&quot;当前 Transmission Web 目录为: &quot;</span>
<span class="token assign-left variable">MSG_SPECIFIED_VERSION</span><span class="token operator">=</span><span class="token string">&quot;您正在使用指定版本安装，版本：&quot;</span>
<span class="token assign-left variable">MSG_SEARCHING_TR_FOLDER</span><span class="token operator">=</span><span class="token string">&quot;正在搜索 Transmission Web 目录...&quot;</span>
<span class="token assign-left variable">MSG_THE_SPECIFIED_DIRECTORY_DOES_NOT_EXIST</span><span class="token operator">=</span><span class="token string">&quot;指定的目录不存在，准备进行搜索，请稍候...&quot;</span>
<span class="token assign-left variable">MSG_USE_WEB_HOME</span><span class="token operator">=</span><span class="token string">&quot;使用 TRANSMISSION_WEB_HOME 变量: <span class="token variable">$TRANSMISSION_WEB_HOME</span>&quot;</span>
<span class="token assign-left variable">MSG_AVAILABLE</span><span class="token operator">=</span><span class="token string">&quot;可用&quot;</span>
<span class="token assign-left variable">MSG_TRY_SPECIFIED_VERSION</span><span class="token operator">=</span><span class="token string">&quot;正在尝试指定版本&quot;</span>
<span class="token assign-left variable">MSG_PACK_COPYING</span><span class="token operator">=</span><span class="token string">&quot;正在复制安装包...&quot;</span>
<span class="token assign-left variable">MSG_WEB_PATH_IS_MISSING</span><span class="token operator">=</span><span class="token string">&quot;错误 : Transmisson WEB 目录不存在，请确认是否已安装 Transmisson 。&quot;</span>
<span class="token assign-left variable">MSG_PACK_IS_EXIST</span><span class="token operator">=</span><span class="token string">&quot; 已存在，是否重新下载？（y/n）&quot;</span>
<span class="token assign-left variable">MSG_SIKP_DOWNLOAD</span><span class="token operator">=</span><span class="token string">&quot;<span class="token entity" title="\n">\n</span>跳过下载，正在准备安装&quot;</span>
<span class="token assign-left variable">MSG_DOWNLOADING</span><span class="token operator">=</span><span class="token string">&quot;正在下载 Transmission Web Control...&quot;</span>
<span class="token assign-left variable">MSG_DOWNLOAD_COMPLETE</span><span class="token operator">=</span><span class="token string">&quot;下载完成，正在准备安装...&quot;</span>
<span class="token assign-left variable">MSG_DOWNLOAD_FAILED</span><span class="token operator">=</span><span class="token string">&quot;安装包下载失败，请重试或尝试其他版本。&quot;</span>
<span class="token assign-left variable">MSG_INSTALL_COMPLETE</span><span class="token operator">=</span><span class="token string">&quot;Transmission Web Control 安装完成!&quot;</span>
<span class="token assign-left variable">MSG_PACK_EXTRACTING</span><span class="token operator">=</span><span class="token string">&quot;正在解压安装包...&quot;</span>
<span class="token assign-left variable">MSG_PACK_CLEANING_UP</span><span class="token operator">=</span><span class="token string">&quot;正在清理安装包...&quot;</span>
<span class="token assign-left variable">MSG_DONE</span><span class="token operator">=</span><span class="token string">&quot;安装脚本执行完成。如遇到问题请查看：https://github.com/ronggang/transmission-web-control/wiki &quot;</span>
<span class="token assign-left variable">MSG_SETTING_PERMISSIONS</span><span class="token operator">=</span><span class="token string">&quot;正在设置权限，大约需要一分钟 ...&quot;</span>
<span class="token assign-left variable">MSG_BEGIN</span><span class="token operator">=</span><span class="token string">&quot;开始&quot;</span>
<span class="token assign-left variable">MSG_END</span><span class="token operator">=</span><span class="token string">&quot;结束&quot;</span>
<span class="token assign-left variable">MSG_MAIN_MENU</span><span class="token operator">=</span><span class="token string">&quot;
	欢迎使用 Transmission Web Control 中文安装脚本。
	官方帮助文档：https://github.com/ronggang/transmission-web-control/wiki 
	安装脚本版本：<span class="token variable">$SCRIPT_VERSION</span> 
	1. 安装最新的发布版本（release）；
	2. 安装指定版本，可用于降级；
	3. 恢复到官方UI；
	4. 重新下载安装脚本（<span class="token variable">$SCRIPT_NAME</span>）；
	5. 检测 Transmission 是否已启动；
	6. 指定安装目录；
	9. 安装最新代码库中的内容（master）；
	===================
	0. 退出安装；
	请输入对应的数字：&quot;</span>
<span class="token assign-left variable">MSG_INPUT_VERSION</span><span class="token operator">=</span><span class="token string">&quot;请输入版本号（如：1.5.1）：&quot;</span>
<span class="token assign-left variable">MSG_INPUT_TR_FOLDER</span><span class="token operator">=</span><span class="token string">&quot;请输入 Transmission Web 所在的目录（不包含web，如：/usr/share/transmission）：&quot;</span>
<span class="token assign-left variable">MSG_SPECIFIED_FOLDER</span><span class="token operator">=</span><span class="token string">&quot;安装目录已指定为：&quot;</span>
<span class="token assign-left variable">MSG_INVALID_PATH</span><span class="token operator">=</span><span class="token string">&quot;输入的路径无效。&quot;</span>
<span class="token assign-left variable">MSG_MASTER_INSTALL_CONFIRM</span><span class="token operator">=</span><span class="token string">&quot;最新代码可能包含未知错误，是否确认安装？ (y/n): &quot;</span>
<span class="token assign-left variable">MSG_FIND_WEB_FOLDER_FROM_PROCESS</span><span class="token operator">=</span><span class="token string">&quot;正在尝试从进程中识别 Transmission Web 目录...&quot;</span>
<span class="token assign-left variable">MSG_FIND_WEB_FOLDER_FROM_PROCESS_FAILED</span><span class="token operator">=</span><span class="token string">&quot; × 识别失败，请确认 Transmission 已启动。&quot;</span>
<span class="token assign-left variable">MSG_CHECK_TR_DAEMON</span><span class="token operator">=</span><span class="token string">&quot;正在检测 Transmission 进程...&quot;</span>
<span class="token assign-left variable">MSG_CHECK_TR_DAEMON_FAILED</span><span class="token operator">=</span><span class="token string">&quot;在系统进程中没有找到 Transmission ，请确认是否已启动。&quot;</span>
<span class="token assign-left variable">MSG_TRY_START_TR</span><span class="token operator">=</span><span class="token string">&quot;是否尝试启动 Transmission ？（y/n）&quot;</span>
<span class="token assign-left variable">MSG_TR_DAEMON_IS_STARTED</span><span class="token operator">=</span><span class="token string">&quot;Transmission 已启动。&quot;</span>
<span class="token assign-left variable">MSG_REVERTING_ORIGINAL_UI</span><span class="token operator">=</span><span class="token string">&quot;正在恢复官方UI...&quot;</span>
<span class="token assign-left variable">MSG_REVERT_COMPLETE</span><span class="token operator">=</span><span class="token string">&quot;恢复完成，在浏览器中重新访问 http://ip:9091/ 或刷新即可查看官方UI。&quot;</span>
<span class="token assign-left variable">MSG_ORIGINAL_UI_IS_MISSING</span><span class="token operator">=</span><span class="token string">&quot;官方UI不存在。&quot;</span>
<span class="token assign-left variable">MSG_DOWNLOADING_INSTALL_SCRIPT</span><span class="token operator">=</span><span class="token string">&quot;正在重新下载安装脚本...&quot;</span>
<span class="token assign-left variable">MSG_INSTALL_SCRIPT_DOWNLOAD_COMPLETE</span><span class="token operator">=</span><span class="token string">&quot;下载完成，请重新运行安装脚本。&quot;</span>
<span class="token assign-left variable">MSG_INSTALL_SCRIPT_DOWNLOAD_FAILED</span><span class="token operator">=</span><span class="token string">&quot;安装脚本下载失败！&quot;</span>
<span class="token assign-left variable">MSG_NON_ROOT_USER</span><span class="token operator">=</span><span class="token string">&quot;无法确认当前是否为 root 用户，可能无法进行安装操作。是否继续？（y/n）&quot;</span>
<span class="token comment">#==========================================================</span>

<span class="token comment"># 是否自动安装</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$ARG1</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;auto&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
	<span class="token assign-left variable">AUTOINSTALL</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token keyword">else</span>
	<span class="token assign-left variable">ROOT_FOLDER</span><span class="token operator">=</span><span class="token variable">$ARG1</span>
<span class="token keyword">fi</span>

<span class="token function-name function">initValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment"># 判断临时目录是否存在，不存在则创建</span>
	<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">&quot;<span class="token variable">$TMP_FOLDER</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token function">mkdir</span> -p <span class="token string">&quot;<span class="token variable">$TMP_FOLDER</span>&quot;</span>
	<span class="token keyword">fi</span>

    <span class="token comment"># 判断是否指定了ROOT_FOLDER</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$ROOT_FOLDER</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token comment"># 获取 Transmission 目录</span>
        getTransmissionPath
    <span class="token keyword">fi</span>
	<span class="token comment"># 判断 ROOT_FOLDER 是否为一个有效的目录，如果是则表明传递了一个有效路径</span>
	<span class="token keyword">if</span> <span class="token punctuation">[</span> -d <span class="token string">&quot;<span class="token variable">$ROOT_FOLDER</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		showLog <span class="token string">&quot;<span class="token variable">$MSG_TR_WORK_FOLDER</span> <span class="token variable">$ROOT_FOLDER</span>/web&quot;</span>
		<span class="token assign-left variable">INSTALL_TYPE</span><span class="token operator">=</span><span class="token number">3</span>
		<span class="token assign-left variable">WEB_FOLDER</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$ROOT_FOLDER</span>/web&quot;</span>
		<span class="token assign-left variable">SKIP_SEARCH</span><span class="token operator">=</span><span class="token number">1</span>
	<span class="token keyword">fi</span>

	<span class="token comment"># 判断是否指定了版本</span>
	<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$VERSION</span>&quot;</span> <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token comment"># master 或 hash</span>
		<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$VERSION</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;master&quot;</span> -o <span class="token variable">${<span class="token operator">#</span>VERSION}</span> <span class="token operator">=</span> <span class="token number">40</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
			<span class="token assign-left variable">PACK_NAME</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$VERSION</span>.tar.gz&quot;</span>
		<span class="token comment"># 是否指定了 v</span>
		<span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token variable">${VERSION<span class="token operator">:</span>0<span class="token operator">:</span>1}</span> <span class="token operator">=</span> <span class="token string">&quot;v&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
			<span class="token assign-left variable">PACK_NAME</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$VERSION</span>.tar.gz&quot;</span>
			<span class="token assign-left variable">VERSION</span><span class="token operator">=</span><span class="token variable">${VERSION<span class="token operator">:</span>1}</span>
		<span class="token keyword">else</span>
			<span class="token assign-left variable">PACK_NAME</span><span class="token operator">=</span><span class="token string">&quot;v<span class="token variable">$VERSION</span>.tar.gz&quot;</span>
		<span class="token keyword">fi</span>
		showLog <span class="token string">&quot;<span class="token variable">$MSG_SPECIFIED_VERSION</span> <span class="token variable">$VERSION</span>&quot;</span>
		
		<span class="token assign-left variable">DOWNLOAD_URL</span><span class="token operator">=</span><span class="token string">&quot;https://github.com/ronggang/transmission-web-control/archive/<span class="token variable">$PACK_NAME</span>&quot;</span>
	<span class="token keyword">fi</span>	

	<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$SKIP_SEARCH</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token comment"># 查找目录</span>
		findWebFolder
	<span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># 开始</span>
<span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	begin
	<span class="token comment"># 初始化值</span>
	initValues
	<span class="token comment"># 安装</span>
	<span class="token function">install</span>
	<span class="token comment"># 清理</span>
	<span class="token function">clear</span>
<span class="token punctuation">}</span>

<span class="token comment"># 查找Web目录</span>
<span class="token function-name function">findWebFolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment"># 找出web ui 目录</span>
	showLog <span class="token string">&quot;<span class="token variable">$MSG_SEARCHING_TR_FOLDER</span>&quot;</span>
		
	<span class="token comment"># 判断 TRANSMISSION_WEB_HOME 环境变量是否被定义，如果是，直接用这个变量的值</span>
	<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$TRANSMISSION_WEB_HOME</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		showLog <span class="token string">&quot;<span class="token variable">$MSG_USE_WEB_HOME</span>&quot;</span>
		<span class="token comment"># 判断目录是否存在，如果不存在则创建 https://github.com/ronggang/transmission-web-control/issues/167</span>
		<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">&quot;<span class="token variable">$TRANSMISSION_WEB_HOME</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
         <span class="token function">mkdir</span> -p <span class="token string">&quot;<span class="token variable">$TRANSMISSION_WEB_HOME</span>&quot;</span>
      <span class="token keyword">fi</span>
		<span class="token assign-left variable">INSTALL_TYPE</span><span class="token operator">=</span><span class="token number">2</span>
	<span class="token keyword">else</span>
		<span class="token keyword">if</span> <span class="token punctuation">[</span> -d <span class="token string">&quot;<span class="token variable">$ROOT_FOLDER</span>&quot;</span> -a -d <span class="token string">&quot;<span class="token variable">$ROOT_FOLDER</span>/web&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
			<span class="token assign-left variable">WEB_FOLDER</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$ROOT_FOLDER</span>/web&quot;</span>
			<span class="token assign-left variable">INSTALL_TYPE</span><span class="token operator">=</span><span class="token number">1</span>
			showLog <span class="token string">&quot;<span class="token variable">$ROOT_FOLDER</span>/web <span class="token variable">$MSG_AVAILABLE</span>.&quot;</span>
		<span class="token keyword">else</span>
			showLog <span class="token string">&quot;<span class="token variable">$MSG_THE_SPECIFIED_DIRECTORY_DOES_NOT_EXIST</span>&quot;</span>
			<span class="token assign-left variable">ROOT_FOLDER</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">find</span> / -name <span class="token string">'web'</span> -type d <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null<span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">'transmission/web'</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/\/web$//g'</span><span class="token variable">`</span></span>

			<span class="token keyword">if</span> <span class="token punctuation">[</span> -d <span class="token string">&quot;<span class="token variable">$ROOT_FOLDER</span>/web&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
				<span class="token assign-left variable">WEB_FOLDER</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$ROOT_FOLDER</span>/web&quot;</span>
				<span class="token assign-left variable">INSTALL_TYPE</span><span class="token operator">=</span><span class="token number">1</span>
			<span class="token keyword">fi</span>
		<span class="token keyword">fi</span>
	<span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># 安装</span>
<span class="token function-name function">install</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment"># 是否指定版本</span>
	<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$VERSION</span>&quot;</span> <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		showLog <span class="token string">&quot;<span class="token variable">$MSG_TRY_SPECIFIED_VERSION</span> <span class="token variable">$VERSION</span>&quot;</span>
		<span class="token comment"># 下载安装包</span>
		download
		<span class="token comment"># 解压安装包</span>
		unpack

		showLog <span class="token string">&quot;<span class="token variable">$MSG_PACK_COPYING</span>&quot;</span>
		<span class="token comment"># 复制文件到</span>
		<span class="token function">cp</span> -r <span class="token string">&quot;<span class="token variable">$TMP_FOLDER</span>/transmission-web-control-<span class="token variable">$VERSION</span>/src/.&quot;</span> <span class="token string">&quot;<span class="token variable">$WEB_FOLDER</span>/&quot;</span>
		<span class="token comment"># 设置权限</span>
		setPermissions <span class="token string">&quot;<span class="token variable">$WEB_FOLDER</span>&quot;</span>
		<span class="token comment"># 安装完成</span>
		installed

	<span class="token comment"># 如果目录存在，则进行下载和更新动作</span>
	<span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token variable">$INSTALL_TYPE</span> <span class="token operator">=</span> <span class="token number">1</span> -o <span class="token variable">$INSTALL_TYPE</span> <span class="token operator">=</span> <span class="token number">3</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token comment"># 下载安装包</span>
		download
		<span class="token comment"># 创建web文件夹，从 20171014 之后，打包文件不包含web目录，直接打包为src下所有文件</span>
		<span class="token function">mkdir</span> web
		
		<span class="token comment"># 解压缩包</span>
		unpack <span class="token string">&quot;web&quot;</span>
		
		showLog <span class="token string">&quot;<span class="token variable">$MSG_PACK_COPYING</span>&quot;</span>
		<span class="token comment"># 复制文件到</span>
		<span class="token function">cp</span> -r web <span class="token string">&quot;<span class="token variable">$ROOT_FOLDER</span>&quot;</span>
		<span class="token comment"># 设置权限</span>
		setPermissions <span class="token string">&quot;<span class="token variable">$ROOT_FOLDER</span>&quot;</span>
		<span class="token comment"># 安装完成</span>
		installed

	<span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token variable">$INSTALL_TYPE</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token comment"># 下载安装包</span>
		download
		<span class="token comment"># 解压缩包</span>
		unpack <span class="token string">&quot;<span class="token variable">$TRANSMISSION_WEB_HOME</span>&quot;</span>
		<span class="token comment"># 设置权限</span>
		setPermissions <span class="token string">&quot;<span class="token variable">$TRANSMISSION_WEB_HOME</span>&quot;</span>
		<span class="token comment"># 安装完成</span>
		installed

	<span class="token keyword">else</span>
		<span class="token builtin class-name">echo</span> <span class="token string">&quot;##############################################&quot;</span>
		<span class="token builtin class-name">echo</span> <span class="token string">&quot;#&quot;</span>
		<span class="token builtin class-name">echo</span> <span class="token string">&quot;# <span class="token variable">$MSG_WEB_PATH_IS_MISSING</span>&quot;</span>
		<span class="token builtin class-name">echo</span> <span class="token string">&quot;#&quot;</span>
		<span class="token builtin class-name">echo</span> <span class="token string">&quot;##############################################&quot;</span>
	<span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># 下载安装包</span>
<span class="token function-name function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment"># 切换到临时目录</span>
	<span class="token builtin class-name">cd</span> <span class="token string">&quot;<span class="token variable">$TMP_FOLDER</span>&quot;</span>
	<span class="token comment"># 判断安装包文件是否已存在</span>
	<span class="token keyword">if</span> <span class="token punctuation">[</span> -f <span class="token string">&quot;<span class="token variable">$PACK_NAME</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$AUTOINSTALL</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
			<span class="token builtin class-name">echo</span> -n <span class="token string">&quot;<span class="token entity" title="\n">\n</span><span class="token variable">$PACK_NAME</span> <span class="token variable">$MSG_PACK_IS_EXIST</span>&quot;</span>
			<span class="token builtin class-name">read</span> flag
		<span class="token keyword">else</span>
			<span class="token assign-left variable">flag</span><span class="token operator">=</span><span class="token string">&quot;y&quot;</span>
		<span class="token keyword">fi</span>

		<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$flag</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;y&quot;</span> -o <span class="token string">&quot;<span class="token variable">$flag</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;Y&quot;</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
			<span class="token function">rm</span> <span class="token string">&quot;<span class="token variable">$PACK_NAME</span>&quot;</span>
		<span class="token keyword">else</span>
			showLog <span class="token string">&quot;<span class="token variable">$MSG_SIKP_DOWNLOAD</span>&quot;</span>
			<span class="token builtin class-name">return</span> <span class="token number">0</span>
		<span class="token keyword">fi</span>
	<span class="token keyword">fi</span>
	showLog <span class="token string">&quot;<span class="token variable">$MSG_DOWNLOADING</span>&quot;</span>
	<span class="token builtin class-name">echo</span> <span class="token string">&quot;&quot;</span>
	<span class="token function">wget</span> <span class="token string">&quot;<span class="token variable">$DOWNLOAD_URL</span>&quot;</span> --no-check-certificate
	<span class="token comment"># 判断是否下载成功</span>
	<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		showLog <span class="token string">&quot;<span class="token variable">$MSG_DOWNLOAD_COMPLETE</span>&quot;</span>
		<span class="token builtin class-name">return</span> <span class="token number">0</span>
	<span class="token keyword">else</span> 
		showLog <span class="token string">&quot;<span class="token variable">$MSG_DOWNLOAD_FAILED</span>&quot;</span>
		end
		<span class="token builtin class-name">exit</span> <span class="token number">1</span>
	<span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># 安装完成</span>
<span class="token function-name function">installed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	showLog <span class="token string">&quot;<span class="token variable">$MSG_INSTALL_COMPLETE</span>&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment"># 输出日志</span>
<span class="token function-name function">showLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token assign-left variable">TIME</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> <span class="token string">&quot;+%Y-%m-%d %H:%M:%S&quot;</span><span class="token variable">`</span></span>

	<span class="token keyword">case</span> <span class="token variable">$2</span> <span class="token keyword">in</span>
		<span class="token string">&quot;n&quot;</span><span class="token punctuation">)</span>
			<span class="token builtin class-name">echo</span> -n <span class="token string">&quot;&lt;&lt; <span class="token variable">$TIME</span> &gt;&gt; <span class="token variable">$1</span>&quot;</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
		*<span class="token punctuation">)</span>
			<span class="token builtin class-name">echo</span> <span class="token string">&quot;&lt;&lt; <span class="token variable">$TIME</span> &gt;&gt; <span class="token variable">$1</span>&quot;</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
	<span class="token keyword">esac</span>
	
<span class="token punctuation">}</span>

<span class="token comment"># 解压安装包</span>
<span class="token function-name function">unpack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	showLog <span class="token string">&quot;<span class="token variable">$MSG_PACK_EXTRACTING</span>&quot;</span>
	<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span> <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token function">tar</span> -xzf <span class="token string">&quot;<span class="token variable">$PACK_NAME</span>&quot;</span> -C <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span>
	<span class="token keyword">else</span>
		<span class="token function">tar</span> -xzf <span class="token string">&quot;<span class="token variable">$PACK_NAME</span>&quot;</span>
	<span class="token keyword">fi</span>
	<span class="token comment"># 如果之前没有安装过，则先将原系统的文件改为</span>
	<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -f <span class="token string">&quot;<span class="token variable">$WEB_FOLDER</span>/<span class="token variable">$ORG_INDEX_FILE</span>&quot;</span> -a -f <span class="token string">&quot;<span class="token variable">$WEB_FOLDER</span>/<span class="token variable">$INDEX_FILE</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token function">mv</span> <span class="token string">&quot;<span class="token variable">$WEB_FOLDER</span>/<span class="token variable">$INDEX_FILE</span>&quot;</span> <span class="token string">&quot;<span class="token variable">$WEB_FOLDER</span>/<span class="token variable">$ORG_INDEX_FILE</span>&quot;</span>
	<span class="token keyword">fi</span>

	<span class="token comment"># 清除原来的内容</span>
	<span class="token keyword">if</span> <span class="token punctuation">[</span> -d <span class="token string">&quot;<span class="token variable">$WEB_FOLDER</span>/tr-web-control&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token function">rm</span> -rf <span class="token string">&quot;<span class="token variable">$WEB_FOLDER</span>/tr-web-control&quot;</span>
	<span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># 清除工作</span>
<span class="token function-name function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	showLog <span class="token string">&quot;<span class="token variable">$MSG_PACK_CLEANING_UP</span>&quot;</span>
	<span class="token keyword">if</span> <span class="token punctuation">[</span> -f <span class="token string">&quot;<span class="token variable">$PACK_NAME</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token comment"># 删除安装包</span>
		<span class="token function">rm</span> <span class="token string">&quot;<span class="token variable">$PACK_NAME</span>&quot;</span>
	<span class="token keyword">fi</span>

	<span class="token keyword">if</span> <span class="token punctuation">[</span> -d <span class="token string">&quot;<span class="token variable">$TMP_FOLDER</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token comment"># 删除临时目录</span>
		<span class="token function">rm</span> -rf <span class="token string">&quot;<span class="token variable">$TMP_FOLDER</span>&quot;</span>
	<span class="token keyword">fi</span>

	showLog <span class="token string">&quot;<span class="token variable">$MSG_DONE</span>&quot;</span>
	end
<span class="token punctuation">}</span>

<span class="token comment"># 设置权限</span>
<span class="token function-name function">setPermissions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token assign-left variable">folder</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$1</span>&quot;</span>
	showLog <span class="token string">&quot;<span class="token variable">$MSG_SETTING_PERMISSIONS</span>&quot;</span>
	<span class="token comment"># 设置权限</span>
	<span class="token function">find</span> <span class="token string">&quot;<span class="token variable">$folder</span>&quot;</span> -type d -exec <span class="token function">chmod</span> o+rx <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">\</span><span class="token punctuation">;</span>
	<span class="token function">find</span> <span class="token string">&quot;<span class="token variable">$folder</span>&quot;</span> -type f -exec <span class="token function">chmod</span> o+r <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">\</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment"># 开始</span>
<span class="token function-name function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token builtin class-name">echo</span> <span class="token string">&quot;&quot;</span>
	showLog <span class="token string">&quot;== <span class="token variable">$MSG_BEGIN</span> ==&quot;</span>
	showLog <span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment"># 结束</span>
<span class="token function-name function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	showLog <span class="token string">&quot;== <span class="token variable">$MSG_END</span> ==&quot;</span>
	<span class="token builtin class-name">echo</span> <span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment"># 显示主菜单</span>
<span class="token function-name function">showMainMenu</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token builtin class-name">echo</span> -n <span class="token string">&quot;<span class="token variable">$MSG_MAIN_MENU</span>&quot;</span>
	<span class="token builtin class-name">read</span> flag
	<span class="token builtin class-name">echo</span> <span class="token string">&quot;&quot;</span>
	<span class="token keyword">case</span> <span class="token variable">$flag</span> <span class="token keyword">in</span>
		<span class="token number">1</span><span class="token punctuation">)</span>
			getLatestReleases
			main
			<span class="token punctuation">;</span><span class="token punctuation">;</span>

		<span class="token number">2</span><span class="token punctuation">)</span>
			<span class="token builtin class-name">echo</span> -n <span class="token string">&quot;<span class="token variable">$MSG_INPUT_VERSION</span>&quot;</span>
			<span class="token builtin class-name">read</span> VERSION
			main
			<span class="token punctuation">;</span><span class="token punctuation">;</span>
		
		<span class="token number">3</span><span class="token punctuation">)</span>
			revertOriginalUI
			<span class="token punctuation">;</span><span class="token punctuation">;</span>

		<span class="token number">4</span><span class="token punctuation">)</span>
			downloadInstallScript
			<span class="token punctuation">;</span><span class="token punctuation">;</span>

		<span class="token number">5</span><span class="token punctuation">)</span>
			checkTransmissionDaemon
			<span class="token punctuation">;</span><span class="token punctuation">;</span>

		<span class="token number">6</span><span class="token punctuation">)</span>
			<span class="token builtin class-name">echo</span> -n <span class="token string">&quot;<span class="token variable">$MSG_INPUT_TR_FOLDER</span>&quot;</span>
			<span class="token builtin class-name">read</span> input
			<span class="token keyword">if</span> <span class="token punctuation">[</span> -d <span class="token string">&quot;<span class="token variable">$input</span>/web&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
				<span class="token assign-left variable">ROOT_FOLDER</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$input</span>&quot;</span>
				showLog <span class="token string">&quot;<span class="token variable">$MSG_SPECIFIED_FOLDER</span> <span class="token variable">$input</span>/web&quot;</span>
			<span class="token keyword">else</span>
				showLog <span class="token string">&quot;<span class="token variable">$MSG_INVALID_PATH</span>&quot;</span>
			<span class="token keyword">fi</span>
			<span class="token function">sleep</span> <span class="token number">2</span>
			showMainMenu
			<span class="token punctuation">;</span><span class="token punctuation">;</span>
		
		<span class="token comment"># 下载最新的代码</span>
		<span class="token number">9</span><span class="token punctuation">)</span>
			<span class="token builtin class-name">echo</span> -n <span class="token string">&quot;<span class="token variable">$MSG_MASTER_INSTALL_CONFIRM</span>&quot;</span>
			<span class="token builtin class-name">read</span> input
			<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$input</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;y&quot;</span> -o <span class="token string">&quot;<span class="token variable">$input</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;Y&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
				<span class="token assign-left variable">VERSION</span><span class="token operator">=</span><span class="token string">&quot;master&quot;</span>
				main
			<span class="token keyword">else</span>
				showMainMenu
			<span class="token keyword">fi</span>
			<span class="token punctuation">;</span><span class="token punctuation">;</span>
		*<span class="token punctuation">)</span>
			showLog <span class="token string">&quot;<span class="token variable">$MSG_END</span>&quot;</span>
			<span class="token punctuation">;</span><span class="token punctuation">;</span>
	<span class="token keyword">esac</span>
<span class="token punctuation">}</span>

<span class="token comment"># 获取Tr所在的目录</span>
<span class="token function-name function">getTransmissionPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment"># 指定一次当前系统的默认目录</span>
	<span class="token comment"># 用户如知道自己的 Transmission Web 所在的目录，直接修改这个值，以避免搜索所有目录</span>
	<span class="token comment"># ROOT_FOLDER=&quot;/usr/local/transmission/share/transmission&quot;</span>
	<span class="token comment"># Fedora 或 Debian 发行版的默认 ROOT_FOLDER 目录</span>
	<span class="token keyword">if</span> <span class="token punctuation">[</span> -f <span class="token string">&quot;/etc/fedora-release&quot;</span> <span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span> -f <span class="token string">&quot;/etc/debian_version&quot;</span> <span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span> -f <span class="token string">&quot;/etc/openwrt_release&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token assign-left variable">ROOT_FOLDER</span><span class="token operator">=</span><span class="token string">&quot;/usr/share/transmission&quot;</span>
	<span class="token keyword">fi</span>
	
	<span class="token keyword">if</span> <span class="token punctuation">[</span> -f <span class="token string">&quot;/bin/freebsd-version&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token assign-left variable">ROOT_FOLDER</span><span class="token operator">=</span><span class="token string">&quot;/usr/local/share/transmission&quot;</span>
	<span class="token keyword">fi</span>

	<span class="token comment"># 群晖</span>
	<span class="token keyword">if</span> <span class="token punctuation">[</span> -f <span class="token string">&quot;/etc/synoinfo.conf&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token assign-left variable">ROOT_FOLDER</span><span class="token operator">=</span><span class="token string">&quot;/var/packages/transmission/target/share/transmission&quot;</span>
	<span class="token keyword">fi</span>

	<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">&quot;<span class="token variable">$ROOT_FOLDER</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		showLog <span class="token string">&quot;<span class="token variable">$MSG_FIND_WEB_FOLDER_FROM_PROCESS</span>&quot;</span> <span class="token string">&quot;n&quot;</span>
		<span class="token assign-left variable">infos</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">ps</span> -Aww -o <span class="token assign-left variable">command</span><span class="token operator">=</span> <span class="token operator">|</span> <span class="token function">sed</span> -r -e <span class="token string">'/[t]ransmission-da/!d'</span> -e <span class="token string">'s/ .+//'</span><span class="token variable">`</span></span>
		<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$infos</span>&quot;</span> <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
			<span class="token builtin class-name">echo</span> <span class="token string">&quot; √&quot;</span>
			<span class="token assign-left variable">search</span><span class="token operator">=</span><span class="token string">&quot;bin/transmission-daemon&quot;</span>
			<span class="token assign-left variable">replace</span><span class="token operator">=</span><span class="token string">&quot;share/transmission&quot;</span>
			<span class="token assign-left variable">path</span><span class="token operator">=</span><span class="token variable">${infos<span class="token operator">/</span><span class="token operator">/</span>$search<span class="token operator">/</span>$replace}</span>
			<span class="token keyword">if</span> <span class="token punctuation">[</span> -d <span class="token string">&quot;<span class="token variable">$path</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
				<span class="token assign-left variable">ROOT_FOLDER</span><span class="token operator">=</span><span class="token variable">$path</span>
			<span class="token keyword">fi</span>
		<span class="token keyword">else</span>
			<span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$MSG_FIND_WEB_FOLDER_FROM_PROCESS_FAILED</span>&quot;</span>
		<span class="token keyword">fi</span>
	<span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># 获取最后的发布版本号</span>
<span class="token comment"># 因在源码库里提交二进制文件不便于管理，以后将使用这种方式获取最新发布的版本</span>
<span class="token function-name function">getLatestReleases</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token assign-left variable">VERSION</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">wget</span> -O - https://api.github.com/repos/ronggang/transmission-web-control/releases/latest <span class="token operator">|</span> <span class="token function">grep</span> tag_name <span class="token operator">|</span> <span class="token function">head</span> -n <span class="token number">1</span> <span class="token operator">|</span> <span class="token function">cut</span> -d <span class="token string">'&quot;'</span> -f <span class="token number">4</span><span class="token variable">`</span></span>
<span class="token punctuation">}</span>

<span class="token comment"># 检测 Transmission 进程是否存在</span>
<span class="token function-name function">checkTransmissionDaemon</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	showLog <span class="token string">&quot;<span class="token variable">$MSG_CHECK_TR_DAEMON</span>&quot;</span>
	<span class="token function">ps</span> -C transmission-daemon
	<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -ne <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		showLog <span class="token string">&quot;<span class="token variable">$MSG_CHECK_TR_DAEMON_FAILED</span>&quot;</span>
		<span class="token builtin class-name">echo</span> -n <span class="token string">&quot;<span class="token variable">$MSG_TRY_START_TR</span>&quot;</span>
		<span class="token builtin class-name">read</span> input
		<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$input</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;y&quot;</span> -o <span class="token string">&quot;<span class="token variable">$input</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;Y&quot;</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
			<span class="token function">service</span> transmission-daemon start
		<span class="token keyword">fi</span>
	<span class="token keyword">else</span>
		showLog <span class="token string">&quot;<span class="token variable">$MSG_TR_DAEMON_IS_STARTED</span>&quot;</span>
	<span class="token keyword">fi</span>
	<span class="token function">sleep</span> <span class="token number">2</span>
	showMainMenu
<span class="token punctuation">}</span>

<span class="token comment"># 恢复官方UI</span>
<span class="token function-name function">revertOriginalUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	initValues
	<span class="token comment"># 判断是否有官方的UI存在</span>
	<span class="token keyword">if</span> <span class="token punctuation">[</span> -f <span class="token string">&quot;<span class="token variable">$WEB_FOLDER</span>/<span class="token variable">$ORG_INDEX_FILE</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		showLog <span class="token string">&quot;<span class="token variable">$MSG_REVERTING_ORIGINAL_UI</span>&quot;</span>
		<span class="token comment"># 清除原来的内容</span>
		<span class="token keyword">if</span> <span class="token punctuation">[</span> -d <span class="token string">&quot;<span class="token variable">$WEB_FOLDER</span>/tr-web-control&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
			<span class="token function">rm</span> -rf <span class="token string">&quot;<span class="token variable">$WEB_FOLDER</span>/tr-web-control&quot;</span>
			<span class="token function">rm</span> <span class="token string">&quot;<span class="token variable">$WEB_FOLDER</span>/favicon.ico&quot;</span>
			<span class="token function">rm</span> <span class="token string">&quot;<span class="token variable">$WEB_FOLDER</span>/index.html&quot;</span>
			<span class="token function">rm</span> <span class="token string">&quot;<span class="token variable">$WEB_FOLDER</span>/index.mobile.html&quot;</span>
			<span class="token function">mv</span> <span class="token string">&quot;<span class="token variable">$WEB_FOLDER</span>/<span class="token variable">$ORG_INDEX_FILE</span>&quot;</span> <span class="token string">&quot;<span class="token variable">$WEB_FOLDER</span>/<span class="token variable">$INDEX_FILE</span>&quot;</span>
			showLog <span class="token string">&quot;<span class="token variable">$MSG_REVERT_COMPLETE</span>&quot;</span>
		<span class="token keyword">else</span>
			showLog <span class="token string">&quot;<span class="token variable">$MSG_WEB_PATH_IS_MISSING</span>&quot;</span>
			<span class="token function">sleep</span> <span class="token number">2</span>
			showMainMenu
		<span class="token keyword">fi</span>
	<span class="token keyword">else</span>
		showLog <span class="token string">&quot;<span class="token variable">$MSG_ORIGINAL_UI_IS_MISSING</span>&quot;</span>
		<span class="token function">sleep</span> <span class="token number">2</span>
		showMainMenu
	<span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># 重新下载安装脚本</span>
<span class="token function-name function">downloadInstallScript</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">[</span> -f <span class="token string">&quot;<span class="token variable">$SCRIPT_NAME</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token function">rm</span> <span class="token string">&quot;<span class="token variable">$SCRIPT_NAME</span>&quot;</span>
	<span class="token keyword">fi</span>
	showLog <span class="token string">&quot;<span class="token variable">$MSG_DOWNLOADING_INSTALL_SCRIPT</span>&quot;</span>
	<span class="token function">wget</span> <span class="token string">&quot;https://github.com/ronggang/transmission-web-control/raw/master/release/<span class="token variable">$SCRIPT_NAME</span>&quot;</span> --no-check-certificate
	<span class="token comment"># 判断是否下载成功</span>
	<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		showLog <span class="token string">&quot;<span class="token variable">$MSG_INSTALL_SCRIPT_DOWNLOAD_COMPLETE</span>&quot;</span>
	<span class="token keyword">else</span> 
		showLog <span class="token string">&quot;<span class="token variable">$MSG_INSTALL_SCRIPT_DOWNLOAD_FAILED</span>&quot;</span>
		<span class="token function">sleep</span> <span class="token number">2</span>
		showMainMenu
	<span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token environment constant">$USER</span>&quot;</span> <span class="token operator">!=</span> <span class="token string">'root'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
	showLog <span class="token string">&quot;<span class="token variable">$MSG_NON_ROOT_USER</span>&quot;</span> <span class="token string">&quot;n&quot;</span>
	<span class="token builtin class-name">read</span> input
	<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$input</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;n&quot;</span> -o <span class="token string">&quot;<span class="token variable">$input</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;N&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token builtin class-name">exit</span> -1
	<span class="token keyword">fi</span>
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$AUTOINSTALL</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
	getLatestReleases
	main
<span class="token keyword">else</span>
	<span class="token comment"># 执行</span>
	showMainMenu
<span class="token keyword">fi</span>
Footer
© <span class="token number">2022</span> GitHub, Inc.
Footer navigation
Terms
Privacy
Security
Status
Docs
Contact GitHub
Pricing
API
Training
Blog
About
transmission-web-control/install-tr-control-cn.sh at master · ronggang/transmission-web-control

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br><span class="line-number">410</span><br><span class="line-number">411</span><br><span class="line-number">412</span><br><span class="line-number">413</span><br><span class="line-number">414</span><br><span class="line-number">415</span><br><span class="line-number">416</span><br><span class="line-number">417</span><br><span class="line-number">418</span><br><span class="line-number">419</span><br><span class="line-number">420</span><br><span class="line-number">421</span><br><span class="line-number">422</span><br><span class="line-number">423</span><br><span class="line-number">424</span><br><span class="line-number">425</span><br><span class="line-number">426</span><br><span class="line-number">427</span><br><span class="line-number">428</span><br><span class="line-number">429</span><br><span class="line-number">430</span><br><span class="line-number">431</span><br><span class="line-number">432</span><br><span class="line-number">433</span><br><span class="line-number">434</span><br><span class="line-number">435</span><br><span class="line-number">436</span><br><span class="line-number">437</span><br><span class="line-number">438</span><br><span class="line-number">439</span><br><span class="line-number">440</span><br><span class="line-number">441</span><br><span class="line-number">442</span><br><span class="line-number">443</span><br><span class="line-number">444</span><br><span class="line-number">445</span><br><span class="line-number">446</span><br><span class="line-number">447</span><br><span class="line-number">448</span><br><span class="line-number">449</span><br><span class="line-number">450</span><br><span class="line-number">451</span><br><span class="line-number">452</span><br><span class="line-number">453</span><br><span class="line-number">454</span><br><span class="line-number">455</span><br><span class="line-number">456</span><br><span class="line-number">457</span><br><span class="line-number">458</span><br><span class="line-number">459</span><br><span class="line-number">460</span><br><span class="line-number">461</span><br><span class="line-number">462</span><br><span class="line-number">463</span><br><span class="line-number">464</span><br><span class="line-number">465</span><br><span class="line-number">466</span><br><span class="line-number">467</span><br><span class="line-number">468</span><br><span class="line-number">469</span><br><span class="line-number">470</span><br><span class="line-number">471</span><br><span class="line-number">472</span><br><span class="line-number">473</span><br><span class="line-number">474</span><br><span class="line-number">475</span><br><span class="line-number">476</span><br><span class="line-number">477</span><br><span class="line-number">478</span><br><span class="line-number">479</span><br><span class="line-number">480</span><br><span class="line-number">481</span><br><span class="line-number">482</span><br><span class="line-number">483</span><br><span class="line-number">484</span><br><span class="line-number">485</span><br><span class="line-number">486</span><br><span class="line-number">487</span><br><span class="line-number">488</span><br><span class="line-number">489</span><br><span class="line-number">490</span><br><span class="line-number">491</span><br><span class="line-number">492</span><br><span class="line-number">493</span><br><span class="line-number">494</span><br><span class="line-number">495</span><br><span class="line-number">496</span><br><span class="line-number">497</span><br><span class="line-number">498</span><br><span class="line-number">499</span><br><span class="line-number">500</span><br><span class="line-number">501</span><br><span class="line-number">502</span><br><span class="line-number">503</span><br><span class="line-number">504</span><br><span class="line-number">505</span><br><span class="line-number">506</span><br><span class="line-number">507</span><br><span class="line-number">508</span><br><span class="line-number">509</span><br><span class="line-number">510</span><br><span class="line-number">511</span><br><span class="line-number">512</span><br><span class="line-number">513</span><br><span class="line-number">514</span><br><span class="line-number">515</span><br><span class="line-number">516</span><br><span class="line-number">517</span><br><span class="line-number">518</span><br><span class="line-number">519</span><br><span class="line-number">520</span><br><span class="line-number">521</span><br><span class="line-number">522</span><br><span class="line-number">523</span><br><span class="line-number">524</span><br><span class="line-number">525</span><br><span class="line-number">526</span><br><span class="line-number">527</span><br><span class="line-number">528</span><br><span class="line-number">529</span><br><span class="line-number">530</span><br><span class="line-number">531</span><br><span class="line-number">532</span><br><span class="line-number">533</span><br><span class="line-number">534</span><br><span class="line-number">535</span><br><span class="line-number">536</span><br><span class="line-number">537</span><br><span class="line-number">538</span><br><span class="line-number">539</span><br><span class="line-number">540</span><br><span class="line-number">541</span><br><span class="line-number">542</span><br><span class="line-number">543</span><br><span class="line-number">544</span><br><span class="line-number">545</span><br><span class="line-number">546</span><br><span class="line-number">547</span><br><span class="line-number">548</span><br><span class="line-number">549</span><br><span class="line-number">550</span><br><span class="line-number">551</span><br><span class="line-number">552</span><br><span class="line-number">553</span><br><span class="line-number">554</span><br><span class="line-number">555</span><br><span class="line-number">556</span><br><span class="line-number">557</span><br><span class="line-number">558</span><br><span class="line-number">559</span><br><span class="line-number">560</span><br><span class="line-number">561</span><br><span class="line-number">562</span><br></div></div><p><img src="C:%5CUsers%5Cvivid%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20220929111455093.png" alt="image-20220929111455093"></p> <h2 id="docker-安装clouddrive"><a href="#docker-安装clouddrive" class="header-anchor">#</a> docker 安装CloudDrive</h2> <h3 id="开启磁盘共享"><a href="#开启磁盘共享" class="header-anchor">#</a> 开启磁盘共享</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#Option 1: enable MountFlags in docker service</span>
<span class="token function">mkdir</span> -p /etc/systemd/system/docker.service.d/
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> /etc/systemd/system/docker.service.d/clear_mount_propagation_flags.conf</span>
[Service]
MountFlags=shared
EOF</span>
<span class="token comment">#Option 2: enable shared mount option for mapped volume in host</span>
<span class="token function">mount</span> --make-shared <span class="token operator">&lt;</span>volume contains the path to accept cloud mounts<span class="token operator">&gt;</span>
<span class="token function">mount</span> --make-shared /volume1
<span class="token function">mount</span> --make-shared /mnt/disk1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;2.1&quot;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloudnas</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> cloudnas/clouddrive
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> clouddrive
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> &lt;path to accept cloud mounts<span class="token punctuation">&gt;</span><span class="token punctuation">:</span>/CloudNAS<span class="token punctuation">:</span>shared
      <span class="token punctuation">-</span> &lt;path to app data<span class="token punctuation">&gt;</span><span class="token punctuation">:</span>/Config
      <span class="token punctuation">-</span> &lt;other local shared path<span class="token punctuation">&gt;</span><span class="token punctuation">:</span>/media<span class="token punctuation">:</span>shared <span class="token comment">#optional media path of host</span>
    <span class="token key atrule">devices</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /dev/fuse<span class="token punctuation">:</span>/dev/fuse
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped
    <span class="token key atrule">pid</span><span class="token punctuation">:</span> <span class="token string">&quot;host&quot;</span>
    <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#or you can try capp_add -SYS_ADMIN</span>
    <span class="token comment">#cap_add: #SYS_ADMIN cap may fail on some OSes, use privileged: true instead</span>
    <span class="token comment"># - SYS_ADMIN</span>
    <span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">&quot;host&quot;</span> <span class="token comment">#if network_mode doesn't work, use port mapping</span>
    <span class="token comment">#ports:</span>
    <span class="token comment">#   - 9798:9798</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker run -d <span class="token punctuation">\</span>
      --name clouddrive <span class="token punctuation">\</span>
      --restart unless-stopped <span class="token punctuation">\</span>
      -v /mnt/disk1/aliyundisk:/CloudNAS:shared <span class="token punctuation">\</span>
       -v /mnt/disk1/Movie:/movie <span class="token punctuation">\</span>
      --network <span class="token function">host</span> <span class="token punctuation">\</span>
      --pid <span class="token function">host</span> <span class="token punctuation">\</span>
     --privileged <span class="token punctuation">\</span>
     --device /dev/fuse:/dev/fuse <span class="token punctuation">\</span>
     cloudnas/clouddrive
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>docker run -d \
    -v /volume3/docker/chinse/:/config   `# 冒号左边请修改为你想在主机上保存配置、日志等文件的路径` \
    -v/volume3/video:/media     `# 请修改为需要下载字幕的媒体目录，冒号右边可以改成你方便记忆的目录，多个媒体目录需要添加多个-v映射` \
    -v /volume3/docker/browser/:/root/.cache/rod/browser `# 容器重启后无需再次下载 chrome，除非 go-rod 更新` \
    -e PUID=1026 \
    -e PGID=100 \
    -e PERMS=true       `# 是否重设/media权限` \
    -e TZ=Asia/Shanghai `# 时区` \
    -e UMASK=022        `# 权限掩码` \
    -p 19035:19035 `# 从0.20.0版本开始，通过webui来设置` \
    -p 19037:19037 `# webui 的视频列表读取图片用，务必设置不要暴露到外网` \
    --name chinesesubfinder \
    --hostname chinesesubfinder \
    --log-driver &quot;json-file&quot; \
    --log-opt &quot;max-size=100m&quot; `# 限制docker控制台日志大小，可自行调整` \
    allanpk716/chinesesubfinder
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="nas-tool"><a href="#nas-tool" class="header-anchor">#</a> nas-tool</h2> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker run -d <span class="token punctuation">\</span>
  --add-host<span class="token operator">=</span>api.themoviedb.org:13.224.161.90 <span class="token punctuation">\</span>
  --add-host<span class="token operator">=</span>github.com:140.82.112.4  <span class="token punctuation">\</span>
  --name<span class="token operator">=</span>nastools <span class="token punctuation">\</span>
  -e <span class="token assign-left variable">PUID</span><span class="token operator">=</span><span class="token number">1000</span> <span class="token punctuation">\</span>
  -e <span class="token assign-left variable">PGID</span><span class="token operator">=</span><span class="token number">100</span> <span class="token punctuation">\</span>
  -e <span class="token assign-left variable">UMASK</span><span class="token operator">=</span>022 <span class="token variable"><span class="token variable">`</span><span class="token comment">#optional</span><span class="token variable">`</span></span> <span class="token punctuation">\</span>
  -e <span class="token assign-left variable">TZ</span><span class="token operator">=</span>Asia/Shanghai <span class="token punctuation">\</span>
  -e <span class="token assign-left variable">NASTOOL_AUTO_UPDATE</span><span class="token operator">=</span>true <span class="token variable"><span class="token variable">`</span><span class="token comment">#optional</span><span class="token variable">`</span></span> <span class="token punctuation">\</span>
  -p <span class="token number">3000</span>:3000 <span class="token punctuation">\</span>
  -v /mnt/disk1/appdata/nas-tool:/config <span class="token punctuation">\</span>
  -v /mnt/disk1/Movie:/mnt/Medias <span class="token punctuation">\</span>
  --restart always --privileged<span class="token operator">=</span>true <span class="token punctuation">\</span>
  jxxghp/nas-tools:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="chinesesubfinder"><a href="#chinesesubfinder" class="header-anchor">#</a> chinesesubfinder</h2> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker run -d <span class="token punctuation">\</span>
-v /mnt/disk1/appdata/chinesesubfinder:/config <span class="token punctuation">\</span>
-v /mnt/disk1/Movie:/mnt/Medias <span class="token punctuation">\</span>
-v /mnt/disk1/appdata/browser:/root/cache/rod/browser <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">PERMS</span><span class="token operator">=</span>true       <span class="token variable"><span class="token variable">`</span><span class="token comment"># 是否重设/media权限</span><span class="token variable">`</span></span> <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">TZ</span><span class="token operator">=</span>Asia/Shanghai <span class="token variable"><span class="token variable">`</span><span class="token comment"># 时区</span><span class="token variable">`</span></span> <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">UMASK</span><span class="token operator">=</span>022        <span class="token variable"><span class="token variable">`</span><span class="token comment"># 权限掩码</span><span class="token variable">`</span></span> <span class="token punctuation">\</span>
    -p <span class="token number">19035</span>:19035 <span class="token variable"><span class="token variable">`</span><span class="token comment"># 从0.20.0版本开始，通过webui来设置</span><span class="token variable">`</span></span> <span class="token punctuation">\</span>
    -p <span class="token number">19037</span>:19037 <span class="token variable"><span class="token variable">`</span><span class="token comment"># webui 的视频列表读取图片用，务必设置不要暴露到外网</span><span class="token variable">`</span></span> <span class="token punctuation">\</span>
    --name chinesesubfinder <span class="token punctuation">\</span>
    --hostname chinesesubfinder <span class="token punctuation">\</span>
    --log-driver <span class="token string">&quot;json-file&quot;</span> <span class="token punctuation">\</span>
    --log-opt <span class="token string">&quot;max-size=100m&quot;</span> <span class="token variable"><span class="token variable">`</span><span class="token comment"># 限制docker控制台日志大小，可自行调整</span><span class="token variable">`</span></span> <span class="token punctuation">\</span>
    allanpk716/chinesesubfinder
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><div class="edit-link"><a href="https://gitee.com/vividcode/vuepress-blog/edit/master/docs/01.教程/01.docker/01.docker环境搭建.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/11/23, 16:37:17</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><!----> <a href="/vuepress-blog/pages/767b70/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">idea使用教程</div></a></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/vuepress-blog/pages/767b70/">idea使用教程</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2022
    <span></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><i class="close-but">×</i> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"></div></div>
    <script src="/vuepress-blog/assets/js/app.a368dedd.js" defer></script><script src="/vuepress-blog/assets/js/2.55043232.js" defer></script><script src="/vuepress-blog/assets/js/10.a255b6be.js" defer></script>
  </body>
</html>